<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="jobsoffers">
    <!-- Filtres et résultats -->
    <section class="py-5 bg-light">
        <div class="container">
            <div class="row">
                <!-- Filtres latéraux -->
                <div class="col-lg-3 mb-4">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">Filtres avancés</h5>
                        </div>
                        <div class="card-body">
                            <!-- Type de contrat -->
                            <div class="mb-4">
                                <h6 class="mb-3">Type de contrat</h6>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="cdi">
                                    <label class="form-check-label" for="cdi">CDI</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="cdd">
                                    <label class="form-check-label" for="cdd">CDD</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="stage">
                                    <label class="form-check-label" for="stage">Stage</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="freelance">
                                    <label class="form-check-label" for="freelance">Freelance</label>
                                </div>
                            </div>

                            <!-- Expérience -->
                            <div class="mb-4">
                                <h6 class="mb-3">Expérience</h6>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="junior">
                                    <label class="form-check-label" for="junior">Débutant</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="mid">
                                    <label class="form-check-label" for="mid">1-3 ans</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="senior">
                                    <label class="form-check-label" for="senior">4-6 ans</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="expert">
                                    <label class="form-check-label" for="expert">7+ ans</label>
                                </div>
                            </div>

                            <!-- Catégories -->
                            <div class="mb-4">
                                <h6 class="mb-3">Secteur d'activité</h6>
                                <select class="form-select">
                                    <option selected>Tous les secteurs</option>
                                    <option>Informatique & Tech</option>
                                    <option>Finance & Comptabilité</option>
                                    <option>Marketing & Communication</option>
                                    <option>Santé</option>
                                    <option>Éducation</option>
                                    <option>Industrie</option>
                                    <option>Services</option>
                                    <option>Commerce</option>
                                </select>
                            </div>

                            <!-- Date de publication -->
                            <div class="mb-4">
                                <h6 class="mb-3">Date de publication</h6>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="publishDate" id="today" checked>
                                    <label class="form-check-label" for="today">Aujourd'hui</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="publishDate" id="week">
                                    <label class="form-check-label" for="week">Cette semaine</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="publishDate" id="month">
                                    <label class="form-check-label" for="month">Ce mois</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="publishDate" id="anytime">
                                    <label class="form-check-label" for="anytime">Tout moment</label>
                                </div>
                            </div>

                            <button class="btn btn-primary w-100">Appliquer les filtres</button>
                        </div>
                    </div>
                </div>

                <!-- Liste des offres -->
                <div class="col-lg-9">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h2 class="h4 mb-0">5 offres d'emploi disponibles</h2>
                            <p class="text-muted mb-0">Résultats pour "Tous les emplois" à "Toutes les villes"</p>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                Trier par: Pertinence
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Pertinence</a></li>
                                <li><a class="dropdown-item" href="#">Date (plus récente)</a></li>
                                <li><a class="dropdown-item" href="#">Salaire (plus élevé)</a></li>
                                <li><a class="dropdown-item" href="#">Entreprise (A-Z)</a></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Cartes d'offres d'emploi -->
                    <div class="row">
                        <!-- Dynamic job offers -->
                        <div class="col-md-12 mb-4" th:each="offre : ${offres}" th:if="${offres != null && !offres.empty}">
                            <div class="card hover-card shadow-sm">
                                <div class="card-body">
                                    <div class="d-md-flex justify-content-between">
                                        <div class="d-flex mb-3 mb-md-0">
                                            <img th:src="${offre.logoUrl != null ? offre.logoUrl : 'https://via.placeholder.com/64'}" th:alt="${offre.companyName != null ? offre.companyName + ' logo' : 'Company logo'}" class="rounded me-3" style="width:64px;height:64px;object-fit:contain;">
                                            <div>
                                                <h5 class="mb-1" th:text="${offre.title != null ? offre.title : 'Job Title'}">Job Title</h5>
                                                <p class="text-muted mb-1" th:text="${offre.companyName != null ? offre.companyName : 'Company Name'}">Company Name</p>
                                                <p class="mb-0"><i class="fas fa-map-marker-alt me-1 text-primary"></i><span th:text="${offre.location != null ? offre.location : 'Location'}">Location</span></p>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-column align-items-end">
                                            <button class="bookmark mb-2"><i class="far fa-bookmark"></i></button>
                                            <span class="badge bg-light text-dark mb-2" th:if="${offre.minSalary != null && offre.maxSalary != null}">
                                                <span th:text="${#numbers.formatDecimal(offre.minSalary, 1, 2, 'COMMA')}">0</span> -
                                                <span th:text="${#numbers.formatDecimal(offre.maxSalary, 1, 2, 'COMMA')}">0</span> MAD
                                            </span>
                                            <span class="badge bg-light text-dark mb-2" th:unless="${offre.minSalary != null && offre.maxSalary != null}">
                                                Salaire non spécifié
                                            </span>
                                            <p class="small text-muted mb-0 time-ago" th:if="${offre.postedAt != null}">
                                                <span th:text="${#temporals.format(offre.postedAt, 'dd MMM yyyy HH:mm')}"></span>
                                            </p>
                                            <p class="small text-muted mb-0" th:unless="${offre.postedAt != null}">Date non spécifiée</p>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="d-flex flex-wrap gap-2 mb-3">
                                        <span class="badge bg-primary" th:text="${offre.contractType != null ? offre.contractType : 'Non spécifié'}">Contract Type</span>
                                        <span class="badge bg-light text-dark" th:text="${offre.industry != null ? offre.industry : 'Industrie'}">Industry</span>
                                        <span class="badge bg-light text-dark" th:text="${offre.experienceLevel != null ? offre.experienceLevel : 'Expérience'}">Experience Level</span>
                                        <span class="badge bg-light text-dark" th:text="${offre.workMode != null ? offre.workMode : 'Mode de travail'}">Work Mode</span>
                                    </div>
                                    <p class="mb-3" th:text="${offre.description != null ? offre.description : 'Aucune description disponible.'}">Job description</p>
                                    <div class="d-flex justify-content-between">
                                        <a th:href="@{/candidats/jobs/details/{id}(id=${offre.id})}" class="btn btn-outline-primary">Voir détails</a>
                                        <a href="#" class="btn btn-primary">Postuler</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Fallback job offers when no dynamic data exists -->
                        <div class="col-md-12 mb-4" th:if="${offres == null || offres.empty}">
                            <!-- Offre 1 (static) -->
                            <div class="card hover-card shadow-sm">
                                <div class="card-body">
                                    <div class="d-md-flex justify-content-between">
                                        <div class="d-flex mb-3 mb-md-0">
                                            <img src="https://via.placeholder.com/64" class="rounded me-3" alt="Logo entreprise">
                                            <div>
                                                <h5 class="mb-1">Développeur Full Stack</h5>
                                                <p class="text-muted mb-1">TechMagic SARL</p>
                                                <p class="mb-0"><i class="fas fa-map-marker-alt me-1 text-primary"></i>Casablanca</p>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-column align-items-end">
                                            <button class="bookmark mb-2"><i class="far fa-bookmark"></i></button>
                                            <span class="badge bg-light text-dark mb-2">15,000 - 20,000 MAD</span>
                                            <p class="small text-muted mb-0">Publié aujourd'hui</p>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="d-flex flex-wrap gap-2 mb-3">
                                        <span class="badge bg-primary">CDI</span>
                                        <span class="badge bg-light text-dark">Informatique & Tech</span>
                                        <span class="badge bg-light text-dark">3-5 ans d'expérience</span>
                                        <span class="badge bg-light text-dark">Hybride</span>
                                    </div>
                                    <p class="mb-3">Nous recherchons un développeur Full Stack avec des compétences en Java, Spring Boot et React pour rejoindre notre équipe dynamique. Vous serez responsable du développement de nouvelles fonctionnalités...</p>
                                    <div class="d-flex justify-content-between">
                                        <a href="#" class="btn btn-outline-primary">Voir détails</a>
                                        <a href="#" class="btn btn-primary">Postuler</a>
                                    </div>
                                </div>
                            </div>

                            <!-- Offre 2 (static) -->
                            <div class="card hover-card shadow-sm">
                                <div class="card-body">
                                    <div class="d-md-flex justify-content-between">
                                        <div class="d-flex mb-3 mb-md-0">
                                            <img src="https://via.placeholder.com/64" class="rounded me-3" alt="Logo entreprise">
                                            <div>
                                                <h5 class="mb-1">Responsable Marketing Digital</h5>
                                                <p class="text-muted mb-1">MarketPro International</p>
                                                <p class="mb-0"><i class="fas fa-map-marker-alt me-1 text-primary"></i>Rabat</p>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-column align-items-end">
                                            <button class="bookmark mb-2"><i class="far fa-bookmark"></i></button>
                                            <span class="badge bg-light text-dark mb-2">18,000 - 22,000 MAD</span>
                                            <p class="small text-muted mb-0">Publié hier</p>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="d-flex flex-wrap gap-2 mb-3">
                                        <span class="badge bg-primary">CDI</span>
                                        <span class="badge bg-light text-dark">Marketing & Communication</span>
                                        <span class="badge bg-light text-dark">5-7 ans d'expérience</span>
                                        <span class="badge bg-light text-dark">Présentiel</span>
                                    </div>
                                    <p class="mb-3">Nous recherchons un Responsable Marketing Digital pour piloter notre stratégie digitale. Vous serez en charge de développer et d'optimiser les campagnes marketing en ligne, de gérer les réseaux sociaux...</p>
                                    <div class="d-flex justify-content-between">
                                        <a href="#" class="btn btn-outline-primary">Voir détails</a>
                                        <a href="#" class="btn btn-primary">Postuler</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pagination -->
                        <div class="col-12">
                            <nav aria-label="Page navigation">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Précédent</a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Suivant</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Script spécifique pour la page des offres d'emploi -->
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            // Initialisation du slider de salaire
            const salaryRange = document.getElementById('salaryRange');
            const salaryLabel = document.getElementById('salaryLabel');

            if (salaryRange && salaryLabel) {
                salaryRange.addEventListener('input', function() {
                    salaryLabel.textContent = `${this.value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")} MAD+`;
                });
            }

            // Function to format time ago in French
            function formatTimeAgo(postedAt) {
                const now = new Date();
                const postedDate = new Date(postedAt);
                const diffInSeconds = Math.floor((now - postedDate) / 1000);

                if (diffInSeconds < 60) {
                    return "à l'instant";
                } else if (diffInSeconds < 3600) {
                    const minutes = Math.floor(diffInSeconds / 60);
                    return `il y a ${minutes} minute${minutes > 1 ? 's' : ''}`;
                } else if (diffInSeconds < 86400) {
                    const hours = Math.floor(diffInSeconds / 3600);
                    return `il y a ${hours} heure${hours > 1 ? 's' : ''}`;
                } else if (diffInSeconds < 2592000) { // 30 days
                    const days = Math.floor(diffInSeconds / 86400);
                    return `il y a ${days} jour${days > 1 ? 's' : ''}`;
                } else if (diffInSeconds < 31536000) { // 365 days
                    const months = Math.floor(diffInSeconds / 2592000);
                    return `il y a ${months} mois`;
                } else {
                    const years = Math.floor(diffInSeconds / 31536000);
                    return `il y a ${years} an${years > 1 ? 's' : ''}`;
                }
            }

            // Initialize time ago displays
            function updateAllTimeAgo() {
                document.querySelectorAll('.time-ago').forEach(element => {
                    const localDateTime = element.getAttribute('data-posted-at');
                    if (localDateTime) {
                        // Convert LocalDateTime format (yyyy-MM-dd'T'HH:mm) to JavaScript Date
                        const jsDate = new Date(localDateTime + 'Z'); // Add 'Z' to indicate UTC
                        element.textContent = formatTimeAgo(jsDate);
                    }
                });
            }

            // Set initial values and update every minute
            updateAllTimeAgo();
            setInterval(updateAllTimeAgo, 60000); // Update every minute
        });
    </script>
</div>
</body>
</html>